家庭流式传输
===============

家庭中设置一台性能强劲的台式，其重要的功能之一就是流式传输。流媒体播放与流式传输游戏都成为可能。


Steam 流式传输
-------------------

Steam 作为 PC 端的主流游戏平台，其流式传输功能已经比较完善。截至撰稿日（2019 年 6 月），其特性已经包括：

* 支持 Windows, Mac, Linux 设备之间的局域网流式传输
* 可以借助 SteamPlay，在 Linux 上运行原本只适配 Windows 的游戏

因此，在家中设有 Linux 主机的情况下，利用局域网在笔记本或其他设备上传输游戏成为可能。本节对 Steam 流式传输以及 SteamPlay 功能进行大致的介绍。


如何开启 Steam 流式传输
^^^^^^^^^^^^^^^^^^^^^^^^^^

在远程机（例如笔记本）与主机（例如配有高端显卡的台式机）上分别安装好 Steam，并使用同一个账户登录。在第二台设备上登录后，屏幕右下角应当会显示：“xxx 流式传输已可以使用” 的提示，其中 xxx 是另一台设备的名称。你只需要在主机上安装游戏，然后在远程机点击的开始游戏按钮右侧的下拉三角，选择“从 xxx 获取流式传输”，便可以在远程机上进行游戏了。

在流式传输连接时可能会出现问题，请尝试以下解决方案：

* 虽然你并不直接使用主机游玩，但主机必须外接有显示器。一个代替的方法是使用 HDMI 欺骗器，这样就不用为主机配置显示器了。
* 大部分问题是由于端口引起的，特别是只能单向传输的情况。端口要求在远程机与主机上都开放 TCP 27036；如果仍不能连接，尝试再开放 UDP 27036；如果仍然不可以，可以按照 Steam 官方指明的，开放 UDP 端口 27031 和 27036、TCP 端口 27036 和 27037。一般这一步骤只需要在 Windows 设备上操作。
    
    * 在 Windows 设备上，搜索并打开 Windows Defender 防火墙设置，点击左侧的高级设置。在新窗口左侧选择入口规则，然后新建一个端口规则开放对应的端口即可。
    * 在 Linux 设备上的端口管理可以使用 iptables-persistent 命令行软件。

* 在 Windows 设备上，前往网络选项，确定该设备已被设置为“允许被此网络的其他设备发现”。
* 在两个设备上都关闭防火墙。 *注意：即使关闭了防火墙，开放端口的操作也不能省略。*
* 在两个设备上都将 Steam 加入杀毒软件的网络连接白名单。当然，一个更直截有效的方法是退出杀毒软件。
* 尝试在 Steam 的设置中，将“远程畅玩”下的客户端选项改为“高速”。在设备不佳时，有时超时会导致流式传输问题。

其他问题并没有遇到。可能发生的有分辨率适配问题（Windows 对高分辨率屏幕可能有缩放，因此即使两块屏幕分辨率相同也可能出现问题），在主机的 Steam 设置中将“远程畅玩 - 高级主机选项 - 变更桌面分辨率以配合流式传输客户端”勾选即可。


如何准备 SteamPlay
^^^^^^^^^^^^^^^^^^^^^^

SteamPlay 的本质是通过 Steam 开发的 Proton 在后台调用了一个 Wine 环境运行 Windows 游戏，以此实现在 Linux 设备上游玩 Windows 游戏的效果。 目前， Steam 官方给出的“完美支持” SteamPlay 的游戏十分有限，但实际上绝大多数游戏都是可以正常地进行游玩的。

在 Linux 的 Steam 登录帐号，正常情况下你无法在库中看见仅适配 Windows 平台的游戏。但在 Linux 主机的 Steam 设置中，可以开启 SteamPlay 的选项，勾选其右侧的为所有游戏执行 SteamPlay（Proton 选最新的版本即可）。之后便可以在库中发现这些游戏，你可以正常地在 Linux 设备上安装 [#f1]_ 这些游戏了。

对于我们的应用场景，在性能较强的 Linux 主机上开启 SteamPlay 并下载游戏，然后通过路由器局域网连接后便可以在性能弱的设备上，通过流式传输进行游戏了。我十分推荐使用 HDMI 欺骗器，一个不用外接屏幕的主机空间占用是很小的，也十足有家庭服务器的风格。

.. rubric:: 本章注释

.. [#f1] 经过测试，从 Windows 版 Steam 备份的游戏，也可以成功地还原到开启了 SteamPlay 的 Linux 设备上。